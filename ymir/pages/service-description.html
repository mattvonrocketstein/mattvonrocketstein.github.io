<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ymir</title>
    <meta name="description" content="">
    <meta name="author" content="mvr">

    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
        <script src="../theme/html5.js"></script>
        <![endif]-->

    <script src="../theme/js/jquery.min.js"></script>

    <!-- Styles -->
    <link href="../theme/bootstrap.min.css" rel="stylesheet">
    <link href="../theme/local.css" rel="stylesheet">
    <link href="../theme/pygments.css" rel="stylesheet">

    <!-- Feeds -->




  </head>
  <body>
    <div class="topbar">
      <div class="topbar-inner">
        <div class="container-fluid">
          <a class="brand" href="../">ymir</a>
          <ul class="nav">
            <li><a href="../">About</a></li>
            <li><a href="../pages/installation.html">Installation</a></li>
            <li><a href="../pages/ec2.html">Quickstart: EC2</a></li>
            <li><a href="../pages/vagrant.html">Quick Start: Vagrant</a></li>
            <li><a href="../pages/service-description.html">Service Descriptions</a></li>
            <li><a href="../pages/service-operations.html">Service Operations</a></li>
            <li><a href="../pages/service-implementations.html">Service Implementations</a></li>
            <li><a href="../pages/examples.html">Examples</a></li>
            <li><a href="../pages/misc.html">Misc.</a></li>
          </ul>
          <p class="pull-right">
            <a href="https://github.com/mattvonrocketstein/ymir/">[github]</a>
            <!--a href="https://github.com/mattvonrocketstein/ymir/issues">[issues]</a>
          </p-->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="sidebar">
        <div class="well">
          <h3>TOC</h3>
          <ul class=main_toc>
            <li class=page_toc>
              <a href="../">About</a>
              <nav class="sub_toc">
                <div class="toc">
<ul>
<li><a href="#what-is-it">What is it?</a></li>
<li><a href="#who-is-it-for">Who is it for?</a></li>
<li><a href="#under-the-hood">Under the hood</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#contributing">Contributing</a></li>
</ul>
</div>
              </nav>
            </li>
            <li class=page_toc>
              <a href="../pages/installation.html">Installation</a>
              <nav class="sub_toc">
                <div class="toc">
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#suggested-software">Suggested software</a></li>
</ul>
</div>
              </nav>
            </li>
            <li class=page_toc>
              <a href="../pages/ec2.html">Quickstart: EC2</a>
              <nav class="sub_toc">
                <div class="toc">
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#create-boilerplate">Create Boilerplate</a></li>
<li><a href="#customize-things">Customize things</a></li>
<li><a href="#validate-and-create">Validate and create</a></li>
</ul>
</div>
              </nav>
            </li>
            <li class=page_toc>
              <a href="../pages/vagrant.html">Quick Start: Vagrant</a>
            </li>
            <li class=page_toc>
              <a href="../pages/service-description.html">Service Descriptions</a>
              <nav class="sub_toc">
                <div class="toc">
<ul>
<li><a href="#choosing-a-file"><a href="#alt-file" name="alt-file">Choosing a file</a></a></li>
<li><a href="#templating"><a href="#templating" name="templating">Templating</a></a></li>
<li><a href="#ec2-json">EC2 JSON</a></li>
<li><a href="#vagrant-json">Vagrant JSON</a></li>
<li><a href="#health-checks">Health Checks</a></li>
<li><a href="#setup-provision">Setup &amp; provision</a></li>
</ul>
</div>
              </nav>
            </li>
            <li class=page_toc>
              <a href="../pages/service-operations.html">Service Operations</a>
              <nav class="sub_toc">
                <div class="toc">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#built-in-operations">Built-in Operations</a></li>
<li><a href="#setup-operation">Setup Operation</a></li>
<li><a href="#provision-operation">Provision Operation</a></li>
<li><a href="#check-operation">Check Operation</a></li>
<li><a href="#custom-operations">Custom Operations</a></li>
</ul>
</div>
              </nav>
            </li>
            <li class=page_toc>
              <a href="../pages/service-implementations.html">Service Implementations</a>
              <nav class="sub_toc">
                <div class="toc">
<ul>
<li><a href="#prerequisite-reading">Prerequisite reading</a></li>
<li><a href="#puppet-provisioning">Puppet Provisioning</a><ul>
<li><a href="#puppet-deps">Puppet Deps</a></li>
<li><a href="#puppet-facts">Puppet Facts</a></li>
</ul>
</li>
<li><a href="#ansible-provisioning">Ansible Provisioning</a><ul>
<li><a href="#ansible-deps">Ansible Deps</a></li>
<li><a href="#ansible-facts">Ansible Facts</a></li>
</ul>
</li>
<li><a href="#other-provisioning">Other Provisioning</a><ul>
<li><a href="#local-commands">Local commands</a></li>
<li><a href="#remote-commands">Remote commands</a></li>
</ul>
</li>
</ul>
</div>
              </nav>
            </li>
            <li class=page_toc>
              <a href="../pages/examples.html">Examples</a>
              <nav class="sub_toc">
                <div class="toc">
<ul>
<li><a href="#polyglot-demo">Polyglot demo</a></li>
</ul>
</div>
              </nav>
            </li>
            <li class=page_toc>
              <a href="../pages/misc.html">Misc.</a>
              <nav class="sub_toc">
                <div class="toc">
<ul>
<li><a href="#automation-helpers">Automation Helpers</a></li>
<li><a href="#validating-boilerplate">Validating boilerplate</a></li>
<li><a href="#creating-keypairs">Creating Keypairs</a></li>
<li><a href="#synchronizing-security-groups">Synchronizing security groups</a></li>
</ul>
</div>
              </nav>
            </li>
          </ul>
        </div>
        <script>
          $('ul.main_toc nav.sub_toc li > a').each(function(){
            $(this).attr(
               'href',
               $(this).closest('.page_toc').children()[0].href+$(this).attr('href'));
          });
        </script>
        <div class="well">
          <h3>Other Links</h3>
          <ul>
            <li><a href="https://github.com/mattvonrocketstein/ymir/">Source code</a></li>
            <li><a href="https://github.com/mattvonrocketstein/ymir/issues">Issues</a></li>
          </ul>
        </div>
      </div>
      <div class="content">
        <div class='page'>
                <div class="page-header"><h1>Service Descriptions</h1></div>
                <div>
<p>Service descriptions are JSON files conforming to a particular schema.  For the purpose of allowing multiple string indicators ("'" and '"') and including comments in the files, ymir parses a superset of strict JSON.  All comments must be prefixed with "//".</p>
<p>In the boilerplate generated by <code>ymir init</code>, there are two different service description files; <a href="https://github.com/mattvonrocketstein/ymir/blob/master/ymir/skeleton/service.json">one is for ec2</a> and <a href="https://github.com/mattvonrocketstein/ymir/blob/master/ymir/skeleton/vagrant.json">the other is for vagrant</a>.  You can always view the most recent service-description schema/boilerplate at the previous two links to find complete and well-commented examples.</p>
<p>These two files have different schemas, and the schema used by your service description determines the service object that will be instantiated, and the operations that will be available on that service object.</p>
<h4 id="choosing-a-file"><a href="#alt-file" name="alt-file">Choosing a file</a></h4>
<p>By default, ymir assumes your service description is in the <code>service.json</code> file.  <strong>If you have no need of EC2 and only want to work with vagrant</strong></p>
<div class="highlight"><pre><span></span>$ ymir init myservice
$ <span class="nb">cd</span> myservice
$ mv vagrant.json service.json
</pre></div>
<p><strong>If you want to use a file of a specific name</strong>, you can set the environment variable <code>YMIR_SERVICE_JSON=...</code> before running <a href="pages/service-operations.html">service operations</a> commands.  For example:</p>
<div class="highlight"><pre><span></span>$ <span class="nv">YMIR_SERVICE_JSON</span><span class="o">=</span>my_service.json fab create
</pre></div>
<h4 id="templating"><a href="#templating" name="templating">Templating</a></h4>
<p>Service description files support reflective templating, or to put it another way, values inside your JSON may be used to render other values inside your template.  (Under the hood, this works with <a href="http://jinja.pocoo.org/docs/dev/">jinja2</a>).</p>
<p>Always use double-mustaches to indicate template variables.  For example, in the JSON below, the value of "name" would be rendered to "OrgName-AppName-ServiceName-EnvName".</p>
<div class="highlight"><pre><span></span><span class="x">{ "org_name": "OrgName",</span>
<span class="x">  "app_name": "AppName",</span>
<span class="x">  "env_name": "EnvName",</span>
<span class="x">  "service_name": "ServiceName",</span>
<span class="x">  "name": "</span><span class="cp">{{</span><span class="nv">org_name</span><span class="cp">}}</span><span class="x">-</span><span class="cp">{{</span><span class="nv">app_name</span><span class="cp">}}</span><span class="x">-</span><span class="cp">{{</span><span class="nv">service_name</span><span class="cp">}}</span><span class="x">-</span><span class="cp">{{</span><span class="nv">env_name</span><span class="cp">}}</span><span class="x">",</span>
<span class="x">}</span>
</pre></div>
<p><strong>Lazy variables</strong></p>
<p>Some variables are special, because they are determined just in time.  The main example is <code>{{host}}</code>, because AWS must be consulted in order to determine the external IP address of the service from it's name.</p>
<p>For vagrant-based services, there are several lazy variables which are determined just in time to avoid changing JSON everytime the Vagrantfile changes.  These variables include <code>{{pem}}</code>, <code>{{username}}</code>, and <code>{{port}}</code>.</p>
<h4 id="ec2-json">EC2 JSON</h4>
<script src="https://gist-it.appspot.com/github/mattvonrocketstein/ymir/blob/vagrant/ymir/skeleton/service.json"></script>
<h4 id="vagrant-json">Vagrant JSON</h4>
<p>The <code>vagrant.json</code> schema is much simpler than EC2, because most of the instance particulars will be configured inside the <code>Vagrantfile</code>.</p>
<script src="https://gist-it.appspot.com/github/mattvonrocketstein/ymir/blob/vagrant/ymir/skeleton/vagrant.json"></script>
<h4 id="health-checks">Health Checks</h4>
<h4 id="setup-provision">Setup &amp; provision</h4>
<p>Both the <em>setup_list</em> and <em>provision_list</em> fields describe a list of instructions (such as puppet files which will be invoked in standalone-mode on the remote host).  Each field is a list of strings, where order matters.  Each string is an instruction, and each instruction has the form <strong>protocol://argument_string</strong>.</p>
<p>These are the available protocols:</p>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>remote://...</td>
<td>A command to run on the remote service</td>
<td>This will execute as {{username}}, which normally means sudo is allowed.  <br/> Assumptions should not be made about the working directory.</td>
</tr>
<tr>
<td>local://...</td>
<td>A command to run on the local host</td>
<td>This will execute as the local user, where the working directory is $service_root</td>
</tr>
<tr>
<td>puppet://...</td>
<td>Path to puppet file to apply.</td>
<td>The path is relative to $service_root (usually looks like <code>puppet://puppet/site.pp</code>)</td>
</tr>
<tr>
<td>ansible://...</td>
<td>Name of an ansible module to apply.</td>
<td>Additional ansible arguments may be appended, but should not be necessary.  In particular, the port, pem file, modulepath ($service_root/ansible), etc is already implied.</td>
</tr>
<tr>
<td>ansible-playbook://...</td>
<td>Path to an ansible playbook to apply.</td>
<td>Path is relative to $service_root (usually looks like <code>ansible-playbook://ansible/play.yml</code>)</td>
</tr>
</tbody>
</table>
<p>For more information on the difference between setup and provisioning, please see <a href="#">this section</a> of the service operations documentation.</p></div>
        </div>
        <footer>
          <p>&copy; mvr</p>
        </footer>
      </div>

    </div>
  </body>
</html>