<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>heredoc - Loading MediaWiki into Neo4j with Elixir and Cypher</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://mattvonrocketstein.github.io/heredoc/img/favicon.ico" rel="icon">

<link rel="canonical" href="https://mattvonrocketstein.github.io/heredoc/loading-mediawiki-into-neo4j-with-elixir-and-cypher.html">

        <meta name="author" content="mvr" />
        <meta name="keywords" content="elixir,graphdb,data-science" />
        <meta name="description" content="Part 1 in a series about loading MediaWiki data-dump XML into Neo4j using Elixir and Cypher." />

        <meta property="og:site_name" content="heredoc" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Loading MediaWiki into Neo4j with Elixir and Cypher"/>
        <meta property="og:url" content="https://mattvonrocketstein.github.io/heredoc/loading-mediawiki-into-neo4j-with-elixir-and-cypher.html"/>
        <meta property="og:description" content="Part 1 in a series about loading MediaWiki data-dump XML into Neo4j using Elixir and Cypher."/>
        <meta property="article:published_time" content="2016-09-26" />
            <meta property="article:section" content="elixir" />
            <meta property="article:tag" content="elixir" />
            <meta property="article:tag" content="graphdb" />
            <meta property="article:tag" content="data-science" />
            <meta property="article:author" content="mvr" />

    <link type="text/css" rel="stylesheet" href="https://mattvonrocketstein.github.io/heredoc/theme/css/jquery.tocify.css" />
    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://mattvonrocketstein.github.io/heredoc/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://mattvonrocketstein.github.io/heredoc/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://mattvonrocketstein.github.io/heredoc/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://mattvonrocketstein.github.io/heredoc/theme/css/style.css" type="text/css"/>




    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/js.cookie.js"></script>
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/jquery.min.js"></script>
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/jquery-ui.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/bootstrap.min.js"></script>
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/jquery.tocify.min.js"></script>

    <!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/respond.min.js"></script>

</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icnavbaron-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://mattvonrocketstein.github.io/heredoc/" class="navbar-brand">
heredoc            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li>
                      <a href="/heredoc/tag/python.html">Python</a>
                    </li>
                    <li>
                      <a href="/heredoc/tag/elixir.html">Elixir</a>
                    </li>
                    <li>
                      <a href="/heredoc/tag/devops.html">Devops</a>
                    </li>
                    <li>
                      <a href="/heredoc/tag/data-science.html">Data Science</a>
                    </li>
                    <li>
                      <a href="/heredoc/tag/links.html">Links</a>
                    </li>

            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-2" id="sidebar">
            <div style="">
              <aside>
<div id="aboutme">

    
        <p>
            <center>
              <a id=walkingman_toggle>
                <span id=walkingman_toggle_label style="font-size:7px;position:relative;bottom:15px;">
                      stop animation
                </span><br/>
              <img id=walking_man>
              </a>
            </center>
        </p>
        <script>
          var still = 'https://mattvonrocketstein.github.io/heredoc/img/walking_man_still.png';
          var walking = 'https://mattvonrocketstein.github.io/heredoc/img/walking_man.gif';
          function walkingman_on(){
            $('#walking_man').attr('src', walking);
            $('#walkingman_toggle_label').html('stop animation');
            $("#walkingman_toggle").attr(
                'href', 'javascript:walkingman_off()');
            Cookies.set('walkingman_animate', 1)
          }
          function walkingman_load(){
            var animate = Cookies.get("walkingman_animate")
            if(!animate||animate=="1"){
                walkingman_on()
            }
            else { walkingman_off();}
          }
          function walkingman_off(){
            $('#walking_man').attr('src', still);
            $('#walkingman_toggle_label').html('start animation');
            $("#walkingman_toggle").attr(
                'href', 'javascript:walkingman_on()');
            Cookies.set('walkingman_animate', 0)
          }
          $(document).ready(function(){
            walkingman_load();
            });
        </script>

    <p>
        <strong>Heredoc</strong><br/>
        is a file literal or input stream literal: it is a section of a source code file that is treated as if it were a separate file.  It also happens to be the name of this technical blog..
    </p>
</div><h4>
  <i class="fa fa-home fa-lg"></i>
  <span class="icon-label">Recent</span></h4>
            <ul style="margin-left: 5px;padding:0px; list-style: none;">
                        <li class=li-choice><a href="https://mattvonrocketstein.github.io/heredoc/exploring-wikivoyage-data-with-neo4j-and-cypher-part-2.html">
                            Exploring WikiVoyage data with Neo4j and Cypher: Part 2</li>
                        </a>
                        <li class=li-choice><a href="https://mattvonrocketstein.github.io/heredoc/exploring-wikivoyage-data-with-neo4j-and-cypher-part-3.html">
                            Exploring WikiVoyage data with Neo4j and Cypher: Part 3</li>
                        </a>
                        <li class=li-choice><a href="https://mattvonrocketstein.github.io/heredoc/loading-mediawiki-into-neo4j-with-elixir-and-cypher.html">
                            Loading MediaWiki into Neo4j with Elixir and Cypher</li>
                        </a>
                        <li class=li-choice><a href="https://mattvonrocketstein.github.io/heredoc/clustering-in-elixir.html">
                            Clustering in Elixir</li>
                        </a>
                        <li class=li-choice><a href="https://mattvonrocketstein.github.io/heredoc/elixir-examples-and-patterns.html">
                            Elixir Examples and Patterns</li>
                        </a>
              </ul>


              <a href="https://mattvonrocketstein.github.io/heredoc/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/ansible.html">
                            ansible
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/boilerplate.html">
                            boilerplate
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/code.html">
                            code
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/cs.html">
                            cs
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/data-science.html">
                            data-science
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/devops.html">
                            devops
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/docker.html">
                            docker
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/elixir.html">
                            elixir
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/fabric.html">
                            fabric
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/graphdb.html">
                            graphdb
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/links.html">
                            links
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/math.html">
                            math
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/misc.html">
                            misc
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/python.html">
                            python
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/unfinished.html">
                            unfinished
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/vagrant.html">
                            vagrant
                        </a>
                    </li>
                </ul>

      <h4><i class="fa fa-github fa-lg"></i>
        <span class="icon-label"><a href="https://github.com/mattvonrocketstein">
          GitHub Repos
        </a></span>
      </h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
      <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="li-choice">
            <a href="http://data.holdings" target="_blank">
                data.holdings
            </a>
        </li>
        <li class="li-choice">
            <a href="http://mattvonrocketstein.github.io/travel" target="_blank">
                travel blog
            </a>
        </li>
        <li class="li-choice">
            <a href="http://localhost:8000/heredoc/random.html" target="_blank">
                random article (this blog)
            </a>
        </li>
      </ul>
            </aside>
            </div>
        </div>
        <div class="col-sm-8">
            <ol class="breadcrumb">
                <li><a href="https://mattvonrocketstein.github.io/heredoc" title="heredoc"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="https://mattvonrocketstein.github.io/heredoc/category/elixir.html" title="elixir">
                  elixir
                </a></li>
                <li class="active">Loading MediaWiki into Neo4j with Elixir and Cypher</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <span class=long-h1>
                    <a href="https://mattvonrocketstein.github.io/heredoc/loading-mediawiki-into-neo4j-with-elixir-and-cypher.html"
                       rel="bookmark"
                       title="Permalink to Loading MediaWiki into Neo4j with Elixir and Cypher">
                        Loading MediaWiki into Neo4j with Elixir and Cypher
                    </a>
                </span>
    <br>
    <table>
      <tr>
        <td>  </td>
        <td>
          Part <strong>1</strong> of
          <strong>3</strong> in
          <strong>"Loading MediaWiki into Neo4j using Elixir and Cypher"</strong>
        </td>
        <td> &nbsp;
<small>
    <a class="btn btn-default btn-xs" href="exploring-wikivoyage-data-with-neo4j-and-cypher-part-2.html">
      next ⇒
    </a>
</small>
 </td>
      </tr>
    </table>
            </header>
            <div class="entry-content">
<footer class="post-info">
    <table style="border-collapse: separate;border-spacing:5px 1px;">
<tr>
  <td class=center>
      <span class="label label-default">Date</span>
  </td>
  <td>
    <span class="published">
      <i class="fa fa-calendar"></i>
      <time datetime="2016-09-26T00:00:00-04:00">
        Mon 26 September 2016
      </time>
    </span>
  </td>
</tr><tr>
	<td class=center>
		<span class="label label-default">
			Tags
		</span>
	</td>
	<td>
			<a href="https://mattvonrocketstein.github.io/heredoc/tag/elixir.html">elixir</a>
,			<a href="https://mattvonrocketstein.github.io/heredoc/tag/graphdb.html">graphdb</a>
,			<a href="https://mattvonrocketstein.github.io/heredoc/tag/data-science.html">data-science</a>
	</td>
</tr>
  </table>
</footer>
<!-- /.post-info -->                <br/>
                <p></p>
<h2>Part 1: Intro</h2>
<p>This is part one of a three part series.  In this part, I'll write about using <a href="http://elixir-lang.org/">Elixir</a> to parse <a href="http://wikivoyage.com">Wikivoyage</a> data dumps and push them into the Neo4j graph database.
I call this project <a href="https://github.com/mattvonrocketstein/rapidmind">rapidmind</a>. <sup id="sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-1-back"><a href="#sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-1" class="simple-footnote" title=' Why "rapidmind"?  Just because whenever I search for elixir-related content on google expecting to find programming language stuff, I find some stuff about a WoW artifact called rapidmind.  Hopefully this will return the favor eventually and screw up some of the search results for those guys =P '>1</a></sup>  If you're most interested in the resulting data structure and how it can be interrogated, you can leave this part and <a href="exploring-wikivoyage-data-with-neo4j-and-cypher-part-2.html">move directly to part 2</a>.</p>
<h2>Motivation</h2>
<p>Initially I intended to parse only <strong>wikipedia</strong> dump files, thinking that it would be very interesting to try and construct graph queries that could infer stuff like "trigonometry is a prerequisite concept of calculus" based on page linkages.  I still might look into this at some point, but after I realized that more or less the same unmodified parsing code could be used with other MediaWiki data dumps I had other ideas.</p>
<p>Maybe the best MediaWiki site to throw into a graph database is the tree of life the friendly folks at [WikiSpecies][https://species.wikimedia.org/wiki/Main_Page] are building.  This project idea is tempting but I'm setting it aside for time being.</p>
<p>Instead for the purposes of this experiment I'll be parsing <a href="https://www.wikivoyage.org/">WikiVoyage</a> data dumps, which is perhaps not so well-known.  WikiVoyage is a MediaWiki project that is building a open travel guide, and I'm going to run with it over other stuff because this dataset should be large enough to be interesting yet quite tractable.   Besides that, I am very interested in travel<sup id="sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-2-back"><a href="#sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-2" class="simple-footnote" title="You can check out my (somewhat neglected) travel blog here">2</a></sup> and geography.  Being a frequent user of WikiVoyage myself, I expected that the inter-page linking structures embedded in content there would be in a kind of information theoretical sweet spot, that is to say less random than what I'd find parsing Wikipedia, but less structured than what I'd find trying to parse WikiSpecies.  </p>
<p><img alt="alt text" src="img/neo-unesco.png"></p>
<h2>The Players</h2>
<p>There are <a href="https://en.wikipedia.org/wiki/Graph_database#List_of_graph_databases">different graph databases</a> out there, but without a lot of compare-and-contrast I decided to go with <a href="https://neo4j.com/">neo4j</a> simply because the community surrounding it is active and growing (and naturally it has all the obligatory WebScale hype). It seems like a good place to start experimenting, but I'm not yet in a position to advocate or condemn it compared with anything else.</p>
<p>For writing GraphDB queries I'll be using Cypher, the standard weapon of choice of Neo4j.  <a href="http://react-etc.net/entry/graph-query-languages-graphql-opencypher-gremlin-and-sparql">Other query languages</a> are out there, and I can't condemn or condone them since I don't know enough.  In particular the extent to which Cypher and OpenCypher are truly compatible is mysterious to me and knowing more about this would be really important for production use-cases.. but none of this really matters for a toy project.</p>
<p>On the Elixir side of things, communication with Neo4j is done using a combination of <a href="https://github.com/CollabRx/callisto/">callisto</a> and <a href="https://github.com/florinpatrascu/neo4j_sips">neo4j_sips</a>.  For parsing XML I'm using <a href="https://github.com/willemdj/erlsom">erlsom</a> which is fairly arcane and pretty awkward to use.  I'm very much indebted to <a href="http://benjamintan.io/blog/2014/10/01/parsing-wikipedia-xml-dump-in-elixir-using-erlsom/">this post</a> for providing a complete working example.  All my <a href="https://github.com/mattvonrocketstein/rapidmind">data-dump parsing code</a> itself will be used here but not discussed much, and that part is basically just a black box for the purposes of this writeup.  </p>
<h2>Setting up Neo4j</h2>
<p>Unless you've already got it up and running, you'll want to install neo4j.  It'll require about 2G RAM at minimum and a java installation.. this can be somewhat of a pain in the ass.  You can accomplish the installation however you like, but I opted not to clutter up my primary development environment.  There is <a href="https://neo4j.com/developer/docker/">official support for docker</a> which you might like to look into.</p>
<p>Personally my standard development environment is an Ubuntu guest on an OSX host, using virtualbox. Only my guests run docker, since I'm fastidious about keeping the host OS as pristine as possible.   Given that I suspected that using docker in the guest for "serious data" might have similarly serious IO bottlenecks (not that I've done real benchmarks).  Thus I opted for a vagrant based approach in a second guest, but your approach may vary.</p>
<p>I suggest spinning up a vagrant box with at least 2G of ram, and using <a href="https://galaxy.ansible.com/julienroubieu/neo4j/">this ansible role</a> to provision it.  <a href="https://gist.github.com/mattvonrocketstein/96670d2eb66a8ad9854b6f52a2b5339c">This gist</a> provides a complete ansible/vagrant/neo4j recipe with instructions.  Therein the guest neo4j server will be accessible from port 7474 on the host.  If you're allergic to ansible then <a href="https://github.com/bretcope/vagrant-neo4j">here</a> is another (untested) vagrant/neo4j recipe that just uses shell scripts.</p>
<p>Regardless of how you get it setup, you'll want to be sure that you can access the fresh neo4j server once it's provisioned.  </p>
<p>Confirm that you can connect to neo:</p>
<div class="highlight"><pre><span></span>$ curl http://localhost:7474
<span class="o">{</span>
  <span class="s2">"management"</span> : <span class="s2">"http://neo_host_ip:7474/db/manage/"</span>,
  <span class="s2">"data"</span> : <span class="s2">"http://neo_host_ip:7474/db/data/"</span>
<span class="o">}</span>
</pre></div>


<p>If you <strong>cannot</strong> connect to neo, then make sure the server is listening on 0.0.0.0 instead of 127.0.0.1  (this setting is inside <code>/etc/neo4j/neo4j-server.properties</code>).  <sup id="sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-3-back"><a href="#sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-3" class="simple-footnote" title=" Other modifications you might like to make: increase the ulimit in the default init script at /etc/init.d/neo4j-service. ">3</a></sup></p>
<h2>Got Data?</h2>
<p>A direct link to the latest XML datadump up the English WikiVoyage content is always <a href="https://dumps.wikimedia.org/enwikivoyage/latest/enwikivoyage-latest-pages-meta-current.xml.bz2">here</a>.  You'll need a copy of this before proceeding to parsing in the next step</p>
<div class="highlight"><pre><span></span>$ wget https://dumps.wikimedia.org/enwikivoyage/latest/enwikivoyage-latest-pages-meta-current.xml.bz2
$ bunzip2 enwikivoyage-latest-pages-meta-current.xml.bz2
$ mv enwikivoyage-latest-pages-meta-current.xml wikivoyage.xml
</pre></div>


<h2>Clone &amp; Configure</h2>
<p>In this writeup I won't go into depth much about the code itself.. just how to use it.  All this assumes of course that you already have <a href="http://elixir-lang.org/install.html">Elixir installed</a>.  Afterwards, clone <a href="https://github.com/mattvonrocketstein/rapidmind">my elixir project repository</a> and install the dependencies with mix</p>
<div class="highlight"><pre><span></span>$ git clone https://github.com/mattvonrocketstein/rapidmind.git
$ <span class="nb">cd</span> rapidmind
$ mix deps.get
$ mix deps.compile
</pre></div>


<p>Edit the connection string for the neo4j server inside <code>config/config.exs</code>, changing the URL line to match your neo4j server.</p>
<div class="highlight"><pre><span></span><span class="nl">url:</span> <span class="s">"http://neo4j_server:7474"</span><span class="o">,</span>
</pre></div>


<p>For me, I have two Vagrant guests: one for Elixir development and one for the Neo4j server.  But since the Neo4j guest is port-forwarded back to the host, my development guest is configured to look for Neo4j on the host.</p>
<div class="highlight"><pre><span></span><span class="nl">url:</span> <span class="s">"http://10.0.2.2:7474"</span><span class="o">,</span>
</pre></div>


<h2>Parsing Data</h2>
<p>After grabbing to code and the data-dump, you should now be able to run the parser against the XML.  In terms of what is populated in the graph DB, this will create "WikiPage" nodes and "links_to" relationships to capture<sup id="sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-4-back"><a href="#sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-4" class="simple-footnote" title=' Link relationships are parsed from page bodies with regexes looking for "[[" and "]]" '>4</a></sup> the inter-wiki links from page bodies.</p>
<div class="highlight"><pre><span></span>$ mix load wikivoyage.xml

<span class="m">16</span> outgoing links <span class="k">for</span> Aba <span class="o">(</span>prefecture<span class="o">)</span>
extracting linked pages <span class="k">for</span> <span class="sb">`</span>Aba as Sa<span class="s1">'ud`</span>
<span class="s1">1 outgoing links for Aba as Sa'</span>ud
extracting linked pages <span class="k">for</span> <span class="sb">`</span>Abacos<span class="sb">`</span>
<span class="m">3</span> outgoing links <span class="k">for</span> Abacos
extracting linked pages <span class="k">for</span> <span class="sb">`</span>Abadan<span class="sb">`</span>
<span class="m">7</span> outgoing links <span class="k">for</span> Abadan
extracting linked pages <span class="k">for</span> <span class="sb">`</span>Abadeh<span class="sb">`</span>
<span class="m">1</span> outgoing links <span class="k">for</span> Abadeh
</pre></div>


<p>Loading the entire wikidump into Neo4j can take many hours, it all depends on your virtual machine resources.  Loading the inter-wiki links will work with everything from wikipedia to wiktionary, etc</p>
<p><strong>Loading extra relationships</strong> (things other than page links) is possible.  There's the <code>mix partof [dumpfile.xml]</code> command, which will add "part_of" relationships to Neo4j.  This particular relationship is more specific to wikivoyage (as in California is part_of the UnitedStates), whereas simply extracting the link structure will work for wikipedia/wiktionary, etc.</p>
<div class="highlight"><pre><span></span>$ mix partof wikivoyage.xml

Southeastern Kansas -contains-&gt; Baxter Springs
Eastern Dominican Republic -contains-&gt; Bayahibe
Gobi -contains-&gt; Bayanhongor
Penang -contains-&gt; Bayan Lepas
Western Inner Mongolia -contains-&gt; Bayan Nur
Nebraska Panhandle -contains-&gt; Bayard
</pre></div>


<h2>Other Commands</h2>
<p>Other commands interacting with the graph database in one way or another are provided for in this project via elixir's <a href="http://elixir-lang.org/getting-started/mix-otp/introduction-to-mix.html">mix tool</a>.</p>
<p><strong>Updating just one Node</strong> is a frequent task if you want to parse it into the graph database without parsing all of the data-dump.  Use <code>mix update &lt;page_title&gt;</code> for this.  The entire data-dump still has to be scanned, which is time consuming, but only the data for page-title you specified will be sent to Neo4j so this is much, much faster than running <code>mix load</code>.  You can use this command judiciously if you want to load only small connected subsets of the wikivoyage graph.  Example output is below:</p>
<div class="highlight"><pre><span></span>$ mix update <span class="s2">"Aachen"</span> ./wikivoyage.xml

skipping 3Days 2Night Chiang Mai to Chiang Rai
skipping <span class="m">3</span> Days in Block Island
skipping <span class="m">4</span> Days Mae Hong Son Loop
skipping <span class="m">4</span> June 2004
skipping <span class="m">7</span> 2
skipping 7+2
skipping <span class="m">88</span> Temple Pilgrimage

extracting linked pages <span class="k">for</span> <span class="sb">`</span>Aachen<span class="sb">`</span>
</pre></div>


<p><strong>Basic statistics</strong> about the graph database can be seen with the <code>mix stats</code> command.  Example output looks something like this:</p>
<div class="highlight"><pre><span></span>$ mix stats

Node Count:
  55545

Top nodes by relationship-count:
   UNESCO World Heritage List <span class="o">(</span>1489<span class="o">)</span>
   United States of America <span class="o">(</span>1454<span class="o">)</span>
   Canada <span class="o">(</span>911<span class="o">)</span>
   India <span class="o">(</span>795<span class="o">)</span>
   California <span class="o">(</span>774<span class="o">)</span>
</pre></div>


<p><strong>To purge Neo4j</strong> without destroying the whole Neo4j virtual machine you can use <code>mix wipedb</code>.  This will also (re)set Neo4j integrity constraints on the empty database.</p>
<div class="highlight"><pre><span></span>$ mix wipedb

<span class="m">1961</span> items left in database
<span class="m">1892</span> items left in database
<span class="m">1443</span> items left in database
<span class="m">1212</span> items left in database
<span class="m">1127</span> items left in database
<span class="m">1048</span> items left in database
<span class="m">779</span> items left in database

database is empty.  adding indexes

<span class="o">[</span><span class="s2">"CREATE CONSTRAINT ON (wp:WikiPage) ASSERT wp.title IS UNIQUE"</span>, <span class="o">[]]</span>
<span class="o">[</span><span class="s2">"CREATE CONSTRAINT ON (wp:WikiPage) ASSERT wp.page_id IS UNIQUE"</span>, <span class="o">[]]</span>
</pre></div>


<p><strong>Running cypher queries</strong> directly against the Neo4j server is also possible using the <code>mix cypher</code> command. See the example below:</p>
<div class="highlight"><pre><span></span>$ mix cypher <span class="s2">"MATCH n WHERE n.title='Yosemite' RETURN n"</span>
<span class="o">{</span>:ok, <span class="o">[</span>%<span class="o">{</span><span class="s2">"n"</span> <span class="o">=</span>&gt; %<span class="o">{</span><span class="s2">"page_id"</span> <span class="o">=</span>&gt; 40124, <span class="s2">"title"</span> <span class="o">=</span>&gt; <span class="s2">"Yosemite"</span><span class="o">}}]}</span>
</pre></div>


<h2>Exploring the data</h2>
<p>So, what we have at this point is a simple but reasonably large graph, where nodes are WikiVoyage pages, and we have 2 kinds of inter-node relationships specified.  What the hell is this data structure?  In short <strong>we have a good model for describing how the website connects to itself</strong>.  Because the website itself is basically trying to describe the world, we sort of have model for the world too even if it's shall we say low-res and second order.  What kinds of questions can we ask and answer with this model, and how can we curate and improve its accuracy?  The data diving begins in <a href="exploring-wikivoyage-data-with-neo4j-and-cypher-part-2.html">the continuation of this series</a></p><ol class="simple-footnotes"><li id="sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-1"> Why "rapidmind"?  Just because whenever I search for elixir-related content on google expecting to find programming language stuff, I find some stuff about a WoW artifact called rapidmind.  Hopefully this will return the favor eventually and screw up some of the search results for those guys =P  <a href="#sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-1-back" class="simple-footnote-back">↩</a></li><li id="sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-2">You can check out my (somewhat neglected) travel blog <a href="/travel">here</a> <a href="#sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-2-back" class="simple-footnote-back">↩</a></li><li id="sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-3"> Other modifications you might like to make: increase the ulimit in the default init script at <code>/etc/init.d/neo4j-service</code>.  <a href="#sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-3-back" class="simple-footnote-back">↩</a></li><li id="sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-4"> Link relationships are parsed from page bodies with regexes looking for "[[" and "]]"  <a href="#sf-loading-mediawiki-into-neo4j-with-elixir-and-cypher-4-back" class="simple-footnote-back">↩</a></li></ol>
            </div>
            <!-- /.entry-content -->
<section class="well" id="series-well">
  Part <strong>1</strong> of
  <strong>3</strong> in
  <strong>"Loading MediaWiki into Neo4j using Elixir and Cypher"</strong>
&nbsp;
<small>
    <a class="btn btn-default btn-xs" href="exploring-wikivoyage-data-with-neo4j-and-cypher-part-2.html">
      next ⇒
    </a>
</small>

     <h5>Next article(s)</h5>
     <ul>
         <li>
           <a href="https://mattvonrocketstein.github.io/heredoc/exploring-wikivoyage-data-with-neo4j-and-cypher-part-2.html">Exploring WikiVoyage data with Neo4j and Cypher: Part 2</a>
           <small>(part 2)</small>
         </li>
         <li>
           <a href="https://mattvonrocketstein.github.io/heredoc/exploring-wikivoyage-data-with-neo4j-and-cypher-part-3.html">Exploring WikiVoyage data with Neo4j and Cypher: Part 3</a>
           <small>(part 3)</small>
         </li>
     </ul>

</section>
<section class="well" id="related-posts-well">
    <ul>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/exploring-wikivoyage-data-with-neo4j-and-cypher-part-3.html">Exploring WikiVoyage data with Neo4j and Cypher: Part 3</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/exploring-wikivoyage-data-with-neo4j-and-cypher-part-2.html">Exploring WikiVoyage data with Neo4j and Cypher: Part 2</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/clustering-in-elixir.html">Clustering in Elixir</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/an-implementation-of-the-ambient-calculus-in-elixir-part-1.html">An implementation of the Ambient Calculus in Elixir: part 1</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/elixir-examples-and-patterns.html">Elixir Examples and Patterns</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/elixir-boilerplate.html">Elixir boilerplate</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/math-cs-ds-links.html">Links for Topics in Math and CS</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/neo4j-vagrant-ansible.html">Setting up Neo4j with Vagrant and Ansible</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/elixir-links.html">Links for Elixir</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/ielixir-notebook-in-docker.html">IElixir Notebook in Docker</a></li>
    </ul>
</section>
        </article>
    </section>

        </div>
        <div class="col-sm-2" >
          <section id=toc class="well well-sm">
            </section>
        </div>
      </div>

    </div>
</div>
<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 mvr
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'https://mattvonrocketstein.github.io/heredoc/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'mattvonrocketstein',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->

<script>
$(document).ready(
  function(){
    $('.simple-footnotes').wrap("<section class=well id=footnotes-well></section>");
    $('#footnotes-well').before("<h2>Footnotes</h2>");
    $('#series-well').before("<h2>Articles in Series</h2>");
    $('#related-posts-well').before("<h2>Related Posts</h2>");
    $("#toc").delay(1000).tocify(
      {
        context: '.entry-content',
        selectors: "h2,h3,h4",
        showAndHide: true,
        showAndHideOnScroll: true,
        extendPage: false,
      }
    )
  }
);</script>
<script>
setTimeout(function(){
  if (""==$('#toc').html().trim()){
    $("#toc").hide()
  }}, 1500)
  </script>
</body>
</html>