<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>heredoc - Python method semantics</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://mattvonrocketstein.github.io/heredoc/img/favicon.ico" rel="icon">

<link rel="canonical" href="https://mattvonrocketstein.github.io/heredoc/python-multimethods.html">

        <meta name="author" content="mvr" />
        <meta name="keywords" content="python" />
        <meta name="description" content="Schizophrenic methods: an Experiment in Python method semantics" />

        <meta property="og:site_name" content="heredoc" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Python method semantics"/>
        <meta property="og:url" content="https://mattvonrocketstein.github.io/heredoc/python-multimethods.html"/>
        <meta property="og:description" content="Schizophrenic methods: an Experiment in Python method semantics"/>
        <meta property="article:published_time" content="2016-07-20" />
            <meta property="article:section" content="Python" />
            <meta property="article:tag" content="python" />
            <meta property="article:author" content="mvr" />

    <link type="text/css" rel="stylesheet" href="https://mattvonrocketstein.github.io/heredoc/theme/css/jquery.tocify.css" />
    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://mattvonrocketstein.github.io/heredoc/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://mattvonrocketstein.github.io/heredoc/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://mattvonrocketstein.github.io/heredoc/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://mattvonrocketstein.github.io/heredoc/theme/css/style.css" type="text/css"/>




    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/js.cookie.js"></script>
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/jquery.min.js"></script>
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/jquery-ui.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/bootstrap.min.js"></script>
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/jquery.tocify.min.js"></script>

    <!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/respond.min.js"></script>

</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icnavbaron-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://mattvonrocketstein.github.io/heredoc/" class="navbar-brand">
heredoc            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li>
                      <a href="/heredoc/tag/projects.html">Projects</a>
                    </li>
                    <li>
                      <a href="/heredoc/tag/python.html">Python</a>
                    </li>
                    <li>
                      <a href="/heredoc/tag/elixir.html">Elixir</a>
                    </li>
                    <li>
                      <a href="/heredoc/tag/devops.html">Devops</a>
                    </li>
                    <li>
                      <a href="/heredoc/tag/data-science.html">Data Science</a>
                    </li>
                    <li>
                      <a href="/heredoc/tag/essays.html">Essays</a>
                    </li>
                    <li>
                      <a href="/heredoc/tag/links.html">Links</a>
                    </li>

            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-2" id="sidebar">
            <div style="">
              <aside>
<div id="aboutme">

    
        <p>
            <center>
              <a id=walkingman_toggle>
                <span id=walkingman_toggle_label style="font-size:7px;position:relative;bottom:15px;">
                      stop animation
                </span><br/>
              <img id=walking_man>
              </a>
            </center>
        </p>
        <script>
          var still = 'https://mattvonrocketstein.github.io/heredoc/img/walking_man_still.png';
          var walking = 'https://mattvonrocketstein.github.io/heredoc/img/walking_man.gif';
          function walkingman_on(){
            $('#walking_man').attr('src', walking);
            $('#walkingman_toggle_label').html('stop animation');
            $("#walkingman_toggle").attr(
                'href', 'javascript:walkingman_off()');
            Cookies.set('walkingman_animate', 1)
          }
          function walkingman_load(){
            var animate = Cookies.get("walkingman_animate")
            if(!animate||animate=="1"){
                walkingman_on()
            }
            else { walkingman_off();}
          }
          function walkingman_off(){
            $('#walking_man').attr('src', still);
            $('#walkingman_toggle_label').html('start animation');
            $("#walkingman_toggle").attr(
                'href', 'javascript:walkingman_on()');
            Cookies.set('walkingman_animate', 0)
          }
          $(document).ready(function(){
            walkingman_load();
            });
        </script>

    <p>
        <strong>Heredoc</strong><br/>
        is a file literal or input stream literal: it is a section of a source code file that is treated as if it were a separate file.  It also happens to be the name of this technical blog..
    </p>
</div><h4>
  <i class="fa fa-home fa-lg"></i>
  <span class="icon-label">Recent</span></h4>
            <ul style="margin-left: 5px;padding:0px; list-style: none;">
                        <li class=li-choice><a href="https://mattvonrocketstein.github.io/heredoc/math-cs-ds-links.html">
                            Links for Topics in Math and CS</li>
                        </a>
                        <li class=li-choice><a href="https://mattvonrocketstein.github.io/heredoc/devops-links.html">
                            Links for Topics in Devops</li>
                        </a>
                        <li class=li-choice><a href="https://mattvonrocketstein.github.io/heredoc/elixir-links.html">
                            Links for Elixir</li>
                        </a>
                        <li class=li-choice><a href="https://mattvonrocketstein.github.io/heredoc/data-science-stack.html">
                            A allspark-based stack for data science projects</li>
                        </a>
                        <li class=li-choice><a href="https://mattvonrocketstein.github.io/heredoc/work-ethos.html">
                            Ethos</li>
                        </a>
              </ul>


              <a href="https://mattvonrocketstein.github.io/heredoc/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/ansible.html">
                            ansible
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/architecture.html">
                            architecture
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/boilerplate.html">
                            boilerplate
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/code.html">
                            code
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/cs.html">
                            cs
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/data-science.html">
                            data-science
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/devops.html">
                            devops
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/docker.html">
                            docker
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/elixir.html">
                            elixir
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/essays.html">
                            essays
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/fabric.html">
                            fabric
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/graphdb.html">
                            graphdb
                        </a>
                    </li>
                    <li class="list-group-item tag-3">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/infrastructure.html">
                            infrastructure
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/links.html">
                            links
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/math.html">
                            math
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/misc.html">
                            misc
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/proglangs.html">
                            proglangs
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/projects.html">
                            projects
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/python.html">
                            python
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/raspberry-pi.html">
                            raspberry-pi
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/unfinished.html">
                            unfinished
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="https://mattvonrocketstein.github.io/heredoc/tag/vagrant.html">
                            vagrant
                        </a>
                    </li>
                </ul>

      <h4><i class="fa fa-github fa-lg"></i>
        <span class="icon-label"><a href="https://github.com/mattvonrocketstein">
          GitHub Repos
        </a></span>
      </h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
      <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="li-choice">
            <a href="http://data.holdings" target="_blank">
                data.holdings
            </a>
        </li>
        <li class="li-choice">
            <a href="http://mattvonrocketstein.github.io/travel" target="_blank">
                travel blog
            </a>
        </li>
        <li class="li-choice">
            <a href="http://localhost:8000/heredoc/random.html" target="_blank">
                random article (this blog)
            </a>
        </li>
      </ul>
            </aside>
            </div>
        </div>
        <div class="col-sm-8">
            <ol class="breadcrumb">
                <li><a href="https://mattvonrocketstein.github.io/heredoc" title="heredoc"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="https://mattvonrocketstein.github.io/heredoc/category/python.html" title="Python">
                  Python
                </a></li>
                <li class="active">Python method semantics</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <span class=long-h1>
                    <a href="https://mattvonrocketstein.github.io/heredoc/python-multimethods.html"
                       rel="bookmark"
                       title="Permalink to Python method semantics">
                        Python method semantics
                    </a>
                </span>
            </header>
            <div class="entry-content">
<footer class="post-info">
    <table style="border-collapse: separate;border-spacing:5px 1px;">
<tr>
  <td class=center>
      <span class="label label-default">Date</span>
  </td>
  <td>
    <span class="published">
      <i class="fa fa-calendar"></i>
      <time datetime="2016-07-20T20:20:00-04:00">
        Wed 20 July 2016
      </time>
    </span>
  </td>
</tr><tr>
	<td class=center>
		<span class="label label-default">
			Tags
		</span>
	</td>
	<td>
			<a href="https://mattvonrocketstein.github.io/heredoc/tag/python.html">python</a>
	</td>
</tr>
  </table>
</footer>
<!-- /.post-info -->                <br/>
                <h2>Intro</h2>
<p>This post describes a fun little piece of code I wrote a few years back.  It's presented here just as a <strong>curiosity</strong> not as a good idea for production code, and more than anything else is just an experiment to demonstrate the flexibility of python as a language.  So let's play with function-call semantics.  This writeup is just some background and motivation, if you're more of a "show me the code!" kind of person, just check out the <a href="https://gist.github.com/mattvonrocketstein/76d6b96d536d2c8ef991">gist here</a>.</p>
<h3>The Idea</h3>
<p>We use "self" all the time in object-oriented python code as an object reference, similar to "this" in Java or Javascript.  It's important to note though that in Python, "self" is only a convention and not a keyword.  When we use "self", the reference is always unambiguous and simple.. we just mean the current instance.  But they say that "art imitates life", so what if object-oriented was inspired by how people work?  </p>
<p>Persons always have one <strong>self</strong> but potentially many <strong>roles</strong>.  For instance, suppose someone asks you a question. It's possible you will answer differently depending on whether you are answering in your capacity as that person's colleague / boss / friend / lover / enemy / etc.  Anyway, the code below contains a (contrived) example. <sup id="sf-python-multimethods-1-back"><a title=" See also: http://www.metrolyrics.com/the-philosophers-song-lyrics-monty-python.html " href="#sf-python-multimethods-1" class="simple-footnote">1</a></sup>.  </p>
<p>Another way of looking at the concept being demonstrated: here there is not one self but many, and what a thing <em>does</em> depends on <em>what</em> you call it, not <em>how</em> you call it.  </p>
<h2>The Code</h2>
<div class="gist">
    <script src='https://gist.github.com/76d6b96d536d2c8ef991.js'></script>
    <noscript>
        <pre><code>"""
   A curiosity for your programming zoo inspired by monty python,
   famous philosophers, and GVR's multimethods demo.

   This code demonstrates metaprogramming as well as runtime reflection
   and introspection.  It also shows python's flexibility by bending language
   semantics and demonstrates that python's "self" is convention (not keyword).
"""
import inspect
import new
import sys

registry = {}

class proxy(object):
    """ master registry for methodnames,
        decorators, and the proxy scope
        dummy object
    """
    pass


def personalityDependant(func):
    """ have to save func in the registry so each duplicate
        function name doesnt just overwrite the previous one

        NOTE: "which_self" is the name of the variable used where
        "self" is usually found in instancemethod definitions
    """
    which_self = inspect.getargspec(func)[0][0]
    if which_self not in registry:
        registry[which_self] = {}
    registry[which_self][func.__name__] = func
    return func


def schizophrenic(func):
    """ tag a function as schizophrenic so the
        metaclass knows when to effect the scope
        mangling.
    """
    func.schizophrenic = True
    return func


class schizotypal(type):
    """ metaclass for all schizoids """

    @staticmethod
    def __new__(mcls, name, bases, clsdict):
        err1 = ('expected a schizotypal object would '
                'have a list of personalities.')
        if 'personalities' not in clsdict:
            raise TypeError(err1)
        else:
            personalities = clsdict['personalities']
            replacement = {}
            for pName in personalities:
                replacement[pName] = registry[pName]
            personalities = replacement
            clsdict['personalities'] = personalities
            klassobj = type.__new__(mcls, name, bases, clsdict)
        return klassobj

    def __call__(cls, *args, **kargs):
        inst = type.__call__(cls, *args, **kargs)
        for var in dir(inst):
            val = getattr(inst, var)
            test = var != '__metaclass__' and var != '__class__'
            if hasattr(val, 'schizophrenic'):
                for pName in inst.personalities:
                    val.func_globals[pName] = inst._as(pName)
        return inst


class schizoid(object):
    """ base schizoid object (inherit from this) """

    __metaclass__ = schizotypal
    personalities = []

    def _as(self, pName):
        """ this method is used to obtain a representation
             of self with respect to a specific personality
        """
        cls = self.__class__
        err = 'illegal personality for ' + str(cls) + ': ' + pName
        assert pName in cls.personalities, err
        out = cls.personalities[pName]
        P = proxy()
        for funcname in out:
            func = out[funcname]
            func = new.instancemethod(func, self, cls)
            setattr(P, funcname, func)
        return P

class myschizoid(schizoid):
    """ a simple demo.

        NB: without the decorators, each status() definition below would simply
        overwrite the previous one.  notice also under normal python semantics
        how theres no reason the philosopher names in the run() method should
        be in scope.
    """
    personalities = ['kant', 'heidegger', 'wittgenstein', 'schlegel']

    @personalityDependant
    def status(kant):
        return "a real pissant"

    @personalityDependant
    def status(heidegger):
        return "a boozy beggar"

    @personalityDependant
    def status(wittgenstein):
        return "beery swine"

    @personalityDependant
    def status(schlegel):
        return "schloshed"

    @schizophrenic
    def run(self):
        print
        print 'kant:\t\t\t', kant.status()
        print 'heidegger:\t\t', heidegger.status()
        print 'wittgenstein:\t\t', wittgenstein.status()
        print 'schlegel:\t\t', schlegel.status()
        print

if __name__ == '__main__':
    s = myschizoid()
    s.run()
</code></pre>
    </noscript>
</div><ol class="simple-footnotes"><li id="sf-python-multimethods-1"> See also: <a href="http://www.metrolyrics.com/the-philosophers-song-lyrics-monty-python.html">http://www.metrolyrics.com/the-philosophers-song-lyrics-monty-python.html</a>  <a href="#sf-python-multimethods-1-back" class="simple-footnote-back">↩</a></li></ol>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts-well">
    <ul>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/ansible-role.html">The missing "ansible-role" command</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/penrose-python-openscad.html">Penrose Tilings & Solid Geometry</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/python-release-automation.html">Python release automation</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/python-dry-versioning.html">DRY versioning for Python packages</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/python-class-as-module.html">Python Class as Module</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/data-science-stack.html">A allspark-based stack for data science projects</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/datadog-event-publishing.html">Datadog event publishing</a></li>
        <li><a href="https://mattvonrocketstein.github.io/heredoc/ielixir-notebook-in-docker.html">IElixir Notebook in Docker</a></li>
    </ul>
</section>
        </article>
    </section>

        </div>
        <div class="col-sm-2" >
          <section id=toc class="well well-sm">
          </section>
        </div>
      </div>

    </div>
</div>
<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2020 mvr
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'https://mattvonrocketstein.github.io/heredoc/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'mattvonrocketstein',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="https://mattvonrocketstein.github.io/heredoc/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->

<script>
$(document).ready(
  function(){
    $('.simple-footnotes').wrap("<section class=well id=footnotes-well></section>");
    $('#footnotes-well').before("<h2>Footnotes</h2>");
    $('#series-well').before("<h2>Articles in Series</h2>");
    $('#related-posts-well').before("<h2>Related Posts</h2>");
    $("#toc").delay(1000).tocify(
      {
        context: '.entry-content',
        selectors: "h2,h3,h4",
        showAndHide: true,
        showAndHideOnScroll: true,
        extendPage: false,
      }
    );
  }
);
function series_button(url,txt){
  return '<a style="background:#efefef;" class="btn btn-default btn-xs" href="'+url+'">'+txt+'</a>'

}
function get_series_nav(x){}</script>
<script>
setTimeout(function(){
  if (""==$('#toc').html().trim()){
    $("#toc").hide()
  }}, 1500)
  </script>
</body>
</html>